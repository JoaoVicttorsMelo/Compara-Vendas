<div align="center"> <h1>📊 DataSync - Sincronização de Vendas entre Lojas e Retaguarda</h1> <img src="https://img.shields.io/badge/Ruby-2.7%2B-red" alt="Ruby Version"> <img src="https://img.shields.io/badge/License-MIT-green" alt="License"> <img src="https://img.shields.io/badge/Status-Em%20Desenvolvimento-orange" alt="Status"> </div> <div> <h2>📝 Descrição</h2> <p><strong>DataSync</strong> é uma aplicação em Ruby que realiza a sincronização de dados de vendas entre as lojas e a retaguarda. Ela compara os valores de vendas diárias, gera relatórios em Excel das discrepâncias encontradas e envia e-mails de notificação para as equipes responsáveis. O objetivo é garantir a consistência dos dados entre os sistemas locais das lojas e o sistema central de retaguarda.</p> </div> <div> <h2>🚀 Funcionalidades</h2> <ul> <li>🔗 <strong>Conexão com Bancos de Dados</strong>: Conecta-se aos bancos de dados SQLite (local), SQL Server das lojas e SQL Server da retaguarda.</li> <li>📝 <strong>Execução de Scripts SQL</strong>: Executa consultas SQL seguras nas bases de dados para obter os valores de vendas.</li> <li>📊 <strong>Comparação de Valores</strong>: Compara os valores de vendas das lojas com os valores da retaguarda para identificar discrepâncias.</li> <li>📈 <strong>Geração de Relatórios</strong>: Gera relatórios em Excel (<code>.xlsx</code>) com as diferenças encontradas utilizando o módulo <code>gerar_excel.rb</code> e a gem <code>write_xlsx</code>.</li> <li>✉️ <strong>Envio de E-mails</strong>: Envia e-mails com os relatórios em anexo para as equipes responsáveis.</li> <li>⏰ <strong>Agendamento de Tarefas</strong>: Pode ser configurado para enviar e-mails a cada 30 minutos até que todas as lojas tenham sido processadas.</li> </ul> </div> <div> <h2>🛠️ Tecnologias Utilizadas</h2> <ul> <li><strong>Linguagem</strong>: <img src="https://img.shields.io/badge/-Ruby-red" alt="Ruby"> Ruby 2.7+</li> <li><strong>Banco de Dados</strong>: SQLite, SQL Server</li> <li><strong>gems</strong>: <ul> <li><code>sqlite3</code>: Interação com o banco de dados SQLite.</li> <li><code>tiny_tds</code>: Conexão com bancos de dados SQL Server.</li> <li><code>write_xlsx</code>: Geração de relatórios em Excel.</li> <li><code>yaml</code>: Carregamento de arquivos de configuração.</li> <li><code>time</code>: Manipulação de datas e horas.</li> </ul> </li> </ul> </div> <div> <h2>📋 Pré-requisitos</h2> <ul> <li>Ruby instalado na versão 2.7 ou superior.</li> <li>Acesso aos bancos de dados SQLite e SQL Server.</li> <li>Configuração adequada do arquivo <code>config.yml</code> com as credenciais de acesso aos bancos de dados.</li> <li>Configuração do módulo <code>EnviarEmail</code> com as credenciais do servidor SMTP.</li> <li>Dependências instaladas listadas no <code>Gemfile</code>.</li> </ul> </div> <div> <h2>🔧 Instalação</h2> <ol> <li> <p><strong>Clone o repositório</strong>:</p> <pre><code>git clone https://github.com/JoaoVicttorsMelo/Compara-Vendas.git cd datasync </code></pre> </li> <li> <p><strong>Instale as dependências</strong>:</p> <pre><code>bundle install</code></pre> </li> <li> <p><strong>Configure o arquivo <code>config.yml</code></strong>:</p> <p>Crie um arquivo <code>config.yml</code> na raiz do projeto com as seguintes informações:</p> <pre><code>database_server: username: 'seu_usuario' password: 'sua_senha' database: - 'nome_banco_loja' - 'nome_banco_loja_alternativo' database_ret: username: 'seu_usuario_ret' password: 'sua_senha_ret' host: 'endereco_do_servidor_ret' database: 'nome_banco_ret' </code></pre> <p>Certifique-se de substituir os valores pelas credenciais reais.</p> </li> <li> <p><strong>Configure o módulo <code>EnviarEmail</code></strong>:</p> <p>No arquivo <code>enviar_email.rb</code>, configure as credenciais do servidor SMTP:</p> <pre><code># enviar_email.rb
module EnviarEmail require 'net/smtp'

Configure aqui suas credenciais SMTP
SMTP_SETTINGS = { address: 'smtp.seuprovedor.com', port: 587, domain: 'seudominio.com', user_name: 'seu_usuario', password: 'sua_senha', authentication:
, enable_starttls_auto: true }

Resto do código...
end </code></pre> </li>

</ol> </div> <div> <h2>🚀 Uso</h2> <ol> <li> <p><strong>Executando a Sincronização de Dados</strong>:</p> <p>Você pode executar o script principal para iniciar o processo de sincronização:</p> <pre><code>ruby main.rb</code></pre> <p>Onde <code>main.rb</code> é o arquivo que instancia a classe <code>Config</code> e chama o método <code>datasync</code>.</p> </li> <li> <p><strong>Agendamento de Tarefas</strong>:</p> <p>Para agendar o envio de e-mails a cada 30 minutos, você pode utilizar o <code>cron</code> do sistema ou uma gem como <code>rufus-scheduler</code>.</p> <p><strong>Exemplo usando <code>cron</code></strong>:</p> <p>Edite o crontab:</p> <pre><code>crontab -e</code></pre> <p>Adicione a seguinte linha para executar o script a cada 30 minutos:</p> <pre><code>*/30 * * * * /usr/bin/ruby /caminho/para/seu_projeto/main.rb</code></pre> </li> <li> <p><strong>Visualizando os Relatórios</strong>:</p> <p>Os relatórios gerados serão salvos na raiz do projeto com o nome <code>relatorio_venda.xlsx</code>.</p> </li> </ol> </div> <div> <h2>🗂️ Estrutura do Projeto</h2> <pre><code>datasync/ ├── config.yml ├── main.rb ├── config.rb ├── gerar_excel.rb ├── enviar_email.rb ├── relatorio_venda.xlsx ├── Gemfile └── README.md </code></pre> <ul> <li><code>config.yml</code>: Arquivo de configuração com as credenciais de acesso aos bancos de dados.</li> <li><code>main.rb</code>: Script principal que inicia o processo de sincronização.</li> <li><code>config.rb</code>: Contém a classe <code>Config</code> com os métodos de conexão e sincronização.</li> <li><code>gerar_excel.rb</code>: Módulo responsável pela geração dos relatórios em Excel.</li> <li><code>enviar_email.rb</code>: Módulo responsável pelo envio de e-mails.</li> <li><code>relatorio_venda.xlsx</code>: Arquivo Excel gerado com o relatório das discrepâncias.</li> <li><code>Gemfile</code>: Lista de gems necessárias para o projeto.</li> <li><code>README.md</code>: Este arquivo.</li> </ul> </div> <div> <h2>✨ Funcionalidades Detalhadas</h2> <h3>🔗 Conexão com Bancos de Dados</h3> <p><strong>SQLite</strong>: Utilizado para armazenar dados locais ou temporários necessários para o processo.</p> <p><strong>SQL Server (Lojas)</strong>: Conecta-se aos bancos de dados das lojas para obter os valores de vendas.</p> <p><strong>SQL Server (Retaguarda)</strong>: Conecta-se ao banco de dados central para obter os valores de vendas consolidados.</p> <h3>📝 Execução de Scripts SQL</h3> <p>Executa consultas SQL seguras nos bancos de dados. Utiliza uma lista de scripts permitidos para evitar a execução de comandos não autorizados.</p> <h3>📊 Comparação de Valores</h3> <p>Compara os valores de vendas obtidos das lojas com os valores da retaguarda. Identifica diferenças que possam indicar problemas de sincronização ou erros nos sistemas.</p> <h3>📈 Geração de Relatórios</h3> <p>O módulo <code>gerar_excel.rb</code> é responsável por gerar um arquivo Excel com as seguintes informações:</p> <ul> <li><strong>Filial</strong></li> <li><strong>Valor na Loja</strong></li> <li><strong>Valor na Retaguarda</strong></li> <li><strong>Diferença</strong></li> </ul> <p>Aplica formatações para melhorar a legibilidade, como cores e formatação condicional.</p> <h3>✉️ Envio de E-mails</h3> <p>O módulo <code>enviar_email.rb</code> envia e-mails automáticos com o relatório em anexo para uma lista de destinatários. Notifica sobre as lojas que não puderam ser processadas ou que apresentaram erros.</p> </div> <div> <h2>⚙️ Configuração</h2> <h3>Arquivo <code>config.yml</code></h3> <p>Certifique-se de configurar corretamente o arquivo <code>config.yml</code> com as credenciais e informações necessárias para acessar os bancos de dados.</p> <h3>Módulo <code>gerar_excel.rb</code></h3> <p>O módulo <code>gerar_excel.rb</code> utiliza a gem <code>write_xlsx</code> para criar relatórios em Excel. Certifique-se de que a gem está instalada e que o módulo está corretamente referenciado em seu código.</p> <h3>Módulo <code>EnviarEmail</code></h3> <p>Configure o módulo <code>enviar_email.rb</code> com as informações do servidor SMTP, porta, usuário, senha e demais parâmetros necessários para o envio de e-mails.</p> </div> <div> <h2>🤝 Contribuição</h2> <p>Contribuições são bem-vindas! Sinta-se à vontade para abrir <strong>issues</strong> e <strong>pull requests</strong>.</p> <ol> <li>Faça um <strong>fork</strong> do projeto.</li> <li>Crie uma nova branch: <code>git checkout -b feature/nova-funcionalidade</code>.</li> <li>Commit suas alterações: <code>git commit -m 'Adiciona nova funcionalidade'</code>.</li> <li>Faça um push para a branch: <code>git push origin feature/nova-funcionalidade</code>.</li> <li>Abra um <strong>pull request</strong>.</li> </ol> </div> <div> <h2>📄 Licença</h2> <p>Este projeto está sob a licença <a href="LICENSE">MIT</a>.</p> </div> <div> <h2>📞 Contato</h2> <p>✉️ Email: <a href="mailto:joaovicttorsilveiramelo@gmail.com">joaovicttorsilveiramelo@gmail.com</a></p> </div>
